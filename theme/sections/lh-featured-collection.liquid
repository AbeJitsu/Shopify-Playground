{%- style -%}
  .lh-fc {
    background-color: #fafaf8;
    padding: 4rem 0;
  }

  @media (min-width: 750px) {
    .lh-fc {
      padding: 5rem 0;
    }
  }

  .lh-fc__header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 0 1.5rem;
  }

  .lh-fc__title {
    font-size: 2rem;
    font-weight: 400;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    margin: 0 0 0.75rem;
    color: #1a1a1a;
  }

  @media (min-width: 750px) {
    .lh-fc__title {
      font-size: 2.5rem;
    }
  }

  .lh-fc__subtitle {
    font-size: 1.0625rem;
    color: #666;
    max-width: 600px;
    margin: 0 auto;
    letter-spacing: 0.08em;
  }

  /* Slider */
  .lh-fc__slider-wrap {
    position: relative;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 3.5rem;
  }

  .lh-fc__slider {
    overflow: hidden;
  }

  .lh-fc__track {
    display: flex;
    gap: 1.5rem;
    transition: transform 0.5s ease;
  }

  .lh-fc__card {
    flex: 0 0 calc(50% - 0.75rem);
    min-width: 0;
  }

  @media (min-width: 750px) {
    .lh-fc__card {
      flex: 0 0 calc(33.333% - 1rem);
    }
  }

  @media (min-width: 1024px) {
    .lh-fc__card {
      flex: 0 0 calc(25% - 1.125rem);
    }
  }

  /* Card image */
  .lh-fc__img-wrap {
    position: relative;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    background: #f0ebe3;
    margin-bottom: 1rem;
  }

  .lh-fc__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .lh-fc__card:hover .lh-fc__img {
    transform: scale(1.03);
  }

  .lh-fc__badge {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: #1a1a1a;
    color: #fff;
    font-size: 0.6875rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 0.375rem 0.75rem;
  }

  /* Card content */
  .lh-fc__name {
    font-size: 1rem;
    font-weight: 500;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: #1a1a1a;
    margin: 0 0 0.5rem;
    line-height: 1.4;
  }

  @media (min-width: 750px) {
    .lh-fc__name {
      font-size: 1.0625rem;
    }
  }

  .lh-fc__stars {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    margin-bottom: 0.5rem;
    font-size: 0.9375rem;
    color: #666;
    letter-spacing: 0.03em;
  }

  .lh-fc__stars svg {
    color: #f5a623;
  }

  .lh-fc__price {
    font-size: 1.0625rem;
    font-weight: 500;
    color: #1a1a1a;
    margin: 0 0 0.75rem;
    letter-spacing: 0.03em;
  }

  /* Color swatches */
  .lh-fc__swatches {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .lh-fc__swatch {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid transparent;
    cursor: pointer;
    transition: border-color 0.2s ease;
    padding: 0;
    background: none;
  }

  .lh-fc__swatch:hover,
  .lh-fc__swatch.active {
    border-color: #1a1a1a;
  }

  .lh-fc__swatch-inner {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 1px solid rgba(0,0,0,0.1);
    box-sizing: border-box;
    pointer-events: none;
  }

  /* Link */
  .lh-fc__link {
    text-decoration: none;
    color: inherit;
    display: block;
  }

  /* Navigation arrows */
  .lh-fc__nav {
    position: absolute;
    top: 35%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    border: none;
    background: transparent;
    color: #1a1a1a;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    transition: opacity 0.3s ease;
  }

  .lh-fc__nav:hover {
    opacity: 0.6;
  }

  .lh-fc__nav:disabled {
    opacity: 0.2;
    cursor: not-allowed;
  }

  .lh-fc__nav--prev {
    left: 0;
  }

  .lh-fc__nav--next {
    right: 0;
  }

  /* Pagination */
  .lh-fc__pagination {
    text-align: center;
    margin-top: 2rem;
    font-size: 0.875rem;
    color: #666;
    letter-spacing: 0.05em;
  }

  /* View all */
  .lh-fc__view-all {
    text-align: center;
    margin-top: 1.5rem;
  }

  .lh-fc__view-all a {
    font-size: 0.9375rem;
    font-weight: 500;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: #1a1a1a;
    text-decoration: none;
    border-bottom: 1px solid #1a1a1a;
    padding-bottom: 2px;
    transition: opacity 0.3s ease;
  }

  .lh-fc__view-all a:hover {
    opacity: 0.6;
  }
{%- endstyle -%}

<section class="lh-fc" id="FeaturedCollection-{{ section.id }}">
  <div class="lh-fc__header">
    <h2 class="lh-fc__title">{{ section.settings.title }}</h2>
    {% if section.settings.subtitle != blank %}
      <p class="lh-fc__subtitle">{{ section.settings.subtitle }}</p>
    {% endif %}
  </div>

  <div class="lh-fc__slider-wrap">
    <button class="lh-fc__nav lh-fc__nav--prev" aria-label="Previous" data-slider-prev>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18L9 12L15 6"/></svg>
    </button>

    <div class="lh-fc__slider">
      <div class="lh-fc__track" data-slider-track>
        {% if section.blocks.size > 0 %}
          {% for block in section.blocks %}
            <div class="lh-fc__card" {{ block.shopify_attributes }}>
              <a href="{{ block.settings.product_link | default: '#' }}" class="lh-fc__link">
                <div class="lh-fc__img-wrap">
                  {% if block.settings.product_image %}
                    <img
                      src="{{ block.settings.product_image | image_url: width: 800 }}"
                      alt="{{ block.settings.product_title }}"
                      class="lh-fc__img"
                      loading="lazy"
                    >
                  {% endif %}
                </div>
              </a>
              <h3 class="lh-fc__name">{{ block.settings.product_title }}</h3>
              <div class="lh-fc__stars">
                <svg width="80" height="14" viewBox="0 0 80 14" fill="currentColor"><path d="M7 0l2.2 4.4L14 5.1l-3.5 3.4.8 4.8L7 11l-4.3 2.3.8-4.8L0 5.1l4.8-.7L7 0zm16 0l2.2 4.4L30 5.1l-3.5 3.4.8 4.8L23 11l-4.3 2.3.8-4.8L16 5.1l4.8-.7L23 0zm16 0l2.2 4.4L46 5.1l-3.5 3.4.8 4.8L39 11l-4.3 2.3.8-4.8L32 5.1l4.8-.7L39 0zm16 0l2.2 4.4L62 5.1l-3.5 3.4.8 4.8L55 11l-4.3 2.3.8-4.8L48 5.1l4.8-.7L55 0zm16 0l2.2 4.4L78 5.1l-3.5 3.4.8 4.8L71 11l-4.3 2.3.8-4.8L64 5.1l4.8-.7L71 0z"/></svg>
                <span>{{ block.settings.product_rating | default: '★★★★★' }}</span>
              </div>
              <p class="lh-fc__price">{{ block.settings.product_price }}</p>
            </div>
          {% endfor %}
        {% else %}
          {%- comment -%} Fallback products with downloaded images {%- endcomment -%}
          {%- assign products_data = 'Cloud Weave Textured Down-Alternative Comforter Set|just-in-1|From $179.00|69 Reviews|#d4c9b8,#c4b9a3,#7a7a5e,#c5c5c5,#6a7a8a;Seersucker Box Textured Down-Alternative Comforter Set|just-in-2|From $179.00|120 Reviews|#7a9aaa,#8a9a7a,#c9a0a0,#e8e8e8;Waffle Textured Down-Alternative Comforter Set|just-in-3|From $179.00|1,576 Reviews|#9aaa9a,#b08a8a,#3a3a5a,#e8e8e8,#7a9aaa,#c4b9a3,#c5c5c5;Mulberry Silk Pillowcases|just-in-4|From $135.00|13 Reviews|#f0ebe3,#c0c0c0,#d4a0a0,#8a9aaa;100% Cotton Percale Sheet Set|just-in-5|From $125.00|Reviews|#8aaaba,#8aaa8a,#f0ebe3,#c5c5c5;Cotton Jersey Knit Sheets|just-in-6|From $166.00|Reviews|#2a2a4a,#8a8a8a,#c5c5c5,#d4c9b8;4-Piece Long Staple 100% Cotton Sheet Set|just-in-7|From $189.00|Reviews|#c5c5c5,#9aaa9a,#7a9aaa,#f0ebe3' | split: ';' -%}

          {%- for product_str in products_data -%}
            {%- assign p = product_str | split: '|' -%}
            {%- assign p_name = p[0] -%}
            {%- assign p_img_prefix = p[1] -%}
            {%- assign p_price = p[2] -%}
            {%- assign p_reviews = p[3] -%}
            {%- assign p_colors = p[4] | split: ',' -%}
            <div class="lh-fc__card" data-product-card>
              <a href="#" class="lh-fc__link">
                <div class="lh-fc__img-wrap">
                  {%- if forloop.index == 4 -%}
                    <span class="lh-fc__badge">New Arrival</span>
                  {%- endif -%}
                  <img
                    src="{{ p_img_prefix | append: '-primary.jpg' | asset_url }}"
                    alt="{{ p_name }}"
                    class="lh-fc__img"
                    loading="lazy"
                    data-primary-src="{{ p_img_prefix | append: '-primary.jpg' | asset_url }}"
                    data-variant-1-src="{{ p_img_prefix | append: '-variant-1.jpg' | asset_url }}"
                    data-variant-2-src="{{ p_img_prefix | append: '-variant-2.jpg' | asset_url }}"
                    data-variant-3-src="{{ p_img_prefix | append: '-variant-3.jpg' | asset_url }}"
                  >
                </div>
              </a>
              <h3 class="lh-fc__name">{{ p_name }}</h3>
              <div class="lh-fc__stars">
                <svg width="80" height="14" viewBox="0 0 80 14" fill="currentColor"><path d="M7 0l2.2 4.4L14 5.1l-3.5 3.4.8 4.8L7 11l-4.3 2.3.8-4.8L0 5.1l4.8-.7L7 0zm16 0l2.2 4.4L30 5.1l-3.5 3.4.8 4.8L23 11l-4.3 2.3.8-4.8L16 5.1l4.8-.7L23 0zm16 0l2.2 4.4L46 5.1l-3.5 3.4.8 4.8L39 11l-4.3 2.3.8-4.8L32 5.1l4.8-.7L39 0zm16 0l2.2 4.4L62 5.1l-3.5 3.4.8 4.8L55 11l-4.3 2.3.8-4.8L48 5.1l4.8-.7L55 0zm16 0l2.2 4.4L78 5.1l-3.5 3.4.8 4.8L71 11l-4.3 2.3.8-4.8L64 5.1l4.8-.7L71 0z"/></svg>
                <span>{{ p_reviews }}</span>
              </div>
              <p class="lh-fc__price">{{ p_price }}</p>
              <div class="lh-fc__swatches">
                {%- for color in p_colors -%}
                  <button
                    class="lh-fc__swatch{% if forloop.first %} active{% endif %}"
                    data-variant-index="{{ forloop.index0 }}"
                    aria-label="Color {{ forloop.index }}"
                  >
                    <span class="lh-fc__swatch-inner" style="background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.35), {{ color }} 60%, rgba(0,0,0,0.15));"></span>
                  </button>
                {%- endfor -%}
              </div>
            </div>
          {%- endfor -%}
        {% endif %}
      </div>
    </div>

    <button class="lh-fc__nav lh-fc__nav--next" aria-label="Next" data-slider-next>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 6L15 12L9 18"/></svg>
    </button>
  </div>

  <div class="lh-fc__pagination" data-slider-pagination></div>

  {% if section.settings.view_all_link != blank %}
    <div class="lh-fc__view-all">
      <a href="{{ section.settings.view_all_link }}">View All</a>
    </div>
  {% endif %}
</section>

<script>
  (function() {
    function initFeaturedCollection() {
      document.querySelectorAll('.lh-fc').forEach(function(section) {
        if (section.dataset.initialized) return;
        section.dataset.initialized = 'true';

        var track = section.querySelector('[data-slider-track]');
        var prevBtn = section.querySelector('[data-slider-prev]');
        var nextBtn = section.querySelector('[data-slider-next]');
        var pagination = section.querySelector('[data-slider-pagination]');
        var cards = track ? track.querySelectorAll('.lh-fc__card') : [];

        if (!track || cards.length === 0) return;

        var currentIndex = 0;

        function getVisible() {
          var w = window.innerWidth;
          if (w < 750) return 2;
          if (w < 1024) return 3;
          return 4;
        }

        function getMaxIndex() {
          return Math.max(0, cards.length - getVisible());
        }

        function update() {
          var visible = getVisible();
          var gap = 1.5;
          var cardPercent = 100 / visible;
          var gapOffset = (gap * 16 * currentIndex) / track.parentElement.offsetWidth * 100;
          track.style.transform = 'translateX(-' + (currentIndex * cardPercent + gapOffset) + '%)';

          if (prevBtn) prevBtn.disabled = currentIndex === 0;
          if (nextBtn) nextBtn.disabled = currentIndex >= getMaxIndex();

          var totalPages = Math.ceil(cards.length / visible);
          var currentPage = Math.floor(currentIndex / visible) + 1;
          if (pagination) pagination.textContent = currentPage + '/' + totalPages;
        }

        if (prevBtn) prevBtn.addEventListener('click', function() {
          if (currentIndex > 0) { currentIndex--; update(); }
        });

        if (nextBtn) nextBtn.addEventListener('click', function() {
          if (currentIndex < getMaxIndex()) { currentIndex++; update(); }
        });

        window.addEventListener('resize', function() {
          currentIndex = Math.min(currentIndex, getMaxIndex());
          update();
        });

        update();

        /* Color swatch image swapping */
        section.querySelectorAll('[data-product-card]').forEach(function(card) {
          var img = card.querySelector('.lh-fc__img');
          var swatches = card.querySelectorAll('.lh-fc__swatch');

          swatches.forEach(function(swatch) {
            swatch.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              var idx = parseInt(swatch.getAttribute('data-variant-index'));
              var src;

              if (idx === 0) {
                src = img.getAttribute('data-primary-src');
              } else if (idx <= 3) {
                src = img.getAttribute('data-variant-' + idx + '-src');
              } else {
                src = img.getAttribute('data-primary-src');
              }

              if (src) img.src = src;

              swatches.forEach(function(s) { s.classList.remove('active'); });
              swatch.classList.add('active');
            });
          });
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFeaturedCollection);
    } else {
      initFeaturedCollection();
    }
  })();
</script>

{% schema %}
{
  "name": "Featured Collection",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "JUST IN"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Section Subtitle",
      "default": "Discover new arrivals designed to bring style and warmth to every space"
    },
    {
      "type": "url",
      "id": "view_all_link",
      "label": "View All Link"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "text",
          "id": "product_title",
          "label": "Product Title",
          "default": "Premium Bedding Set"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product Image"
        },
        {
          "type": "text",
          "id": "product_rating",
          "label": "Reviews Text",
          "default": "★★★★★"
        },
        {
          "type": "text",
          "id": "product_price",
          "label": "Product Price",
          "default": "$89.99"
        },
        {
          "type": "url",
          "id": "product_link",
          "label": "Product Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collection",
      "settings": {
        "title": "JUST IN",
        "subtitle": "Discover new arrivals designed to bring style and warmth to every space"
      }
    }
  ]
}
{% endschema %}
